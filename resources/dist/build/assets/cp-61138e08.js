function o(t,e,s,i,l,c,h,f){var r=typeof t=="function"?t.options:t;e&&(r.render=e,r.staticRenderFns=s,r._compiled=!0),i&&(r.functional=!0),c&&(r._scopeId="data-v-"+c);var n;if(h?(n=function(a){a=a||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!a&&typeof __VUE_SSR_CONTEXT__<"u"&&(a=__VUE_SSR_CONTEXT__),l&&l.call(this,a),a&&a._registeredComponents&&a._registeredComponents.add(h)},r._ssrRegister=n):l&&(n=f?function(){l.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:l),n)if(r.functional){r._injectStyles=n;var m=r.render;r.render=function(p,d){return n.call(d),m(p,d)}}else{var u=r.beforeCreate;r.beforeCreate=u?[].concat(u,n):[n]}return{exports:t,options:r}}const v={props:{sites:{type:Array,required:!0},value:{type:String,required:!0}},computed:{site(){return _.findWhere(this.sites,{handle:this.value})}}};var $=function(){var e=this,s=e._self._c;return s("v-select",{staticClass:"text-sm",attrs:{value:e.site,clearable:!1,searchable:!1,"get-option-label":i=>e.__(i.name),options:e.sites},on:{input:function(i){return e.$emit("input",i)}}})},g=[],b=o(v,$,g,!1,null,null,null,null);const y=b.exports,F={components:{SiteSelector:y},props:{title:String,initialAction:String,method:String,blueprint:Object,initialMeta:Object,initialValues:Object,initialLocalizations:Array,initialSite:String},data(){return{localizing:!1,action:this.initialAction,meta:_.clone(this.initialMeta),values:_.clone(this.initialValues),localizations:_.clone(this.initialLocalizations),site:this.initialSite,error:null,errors:{}}},computed:{isDirty(){return this.$dirty.has(this.publishContainer)}},methods:{clearErrors(){this.error=null,this.errors={}},save(){this.action&&(this.saving=!0,this.clearErrors(),this.$axios[this.method](this.action,this.values).then(t=>{this.saving=!1,this.$toast.success(__("Saved")),this.$refs.container.saved(),this.$emit("saved",t)}).catch(t=>this.handleAxiosError(t)))},handleAxiosError(t){if(this.saving=!1,t.response&&t.response.status===422){const{message:e,errors:s}=t.response.data;this.error=e,this.errors=s,this.$toast.error(e)}else{const e=data_get(t,"response.data.message");this.$toast.error(e||t),console.log(t)}},localizationSelected(t){t.active||this.isDirty&&!confirm(__("Are you sure? Unsaved changes will be lost."))||(this.localizing=t.handle,this.publishContainer==="base"&&window.history.replaceState({},"",t.url),this.$axios.get(t.url).then(e=>{const s=e.data;this.action=s.action,this.values=s.values,this.meta=s.meta,this.localizations=s.localizations,this.site=t.handle,this.localizing=!1,this.$nextTick(()=>this.$refs.container.clearDirtyState())}))}},created(){this.$keys.bindGlobal(["mod+s"],t=>{t.preventDefault(),this.save()})}};var S=function(){var e=this,s=e._self._c;return s("div",[s("header",{staticClass:"mb-6"},[s("div",{staticClass:"flex items-center"},[s("h1",{staticClass:"flex-1",domProps:{textContent:e._s(e.title)}}),e.localizations.length>1?s("site-selector",{staticClass:"rtl:ml-4 ltr:mr-4",attrs:{sites:e.localizations,value:e.site},on:{input:e.localizationSelected}}):e._e(),s("button",{staticClass:"btn-primary min-w-100",domProps:{textContent:e._s(e.__("Save"))},on:{click:function(i){return i.preventDefault(),e.save.apply(null,arguments)}}})],1)]),s("publish-container",{ref:"container",attrs:{name:"base",blueprint:e.blueprint,meta:e.meta,errors:e.errors},scopedSlots:e._u([{key:"default",fn:function({setFieldValue:i,setFieldMeta:l}){return[s("publish-tabs",{on:{updated:i,"meta-updated":l}})]}}]),model:{value:e.values,callback:function(i){e.values=i},expression:"values"}})],1)},C=[],w=o(F,S,C,!1,null,null,null,null);const x=w.exports,k={mixins:[Fieldtype],inject:["storeName"],data(){return{fields:[],selected:null,showFieldtype:!0}},watch:{list(t){this.showFieldtype=!1,this.refreshFields(),this.$nextTick(()=>this.showFieldtype=!0)}},computed:{key(){return this.namePrefix.match(/([a-z]*?)\[(.*?)\]/)[0].replace("[",".").replace("]",".")+"list_id.0"},list(){return data_get(this.$store.state.publish[this.storeName].values,this.key)}},mounted(){this.selected=this.value,this.refreshFields()},methods:{refreshFields(){this.$axios.get(cp_url("/activecampaign/merge-fields")).then(t=>{this.fields=t.data})}}};var z=function(){var e=this,s=e._self._c;return s("div",{staticClass:"activecampaign-merge-fields-fieldtype-wrapper"},[e.showFieldtype?s("v-select",{attrs:{"append-to-body":"",clearable:!0,options:e.fields,reduce:i=>i.id,searchable:!0},on:{input:function(i){return e.$emit("input",i)}},model:{value:e.selected,callback:function(i){e.selected=i},expression:"selected"}}):e._e()],1)},R=[],A=o(k,z,R,!1,null,null,null,null);const T=A.exports,N={mixins:[Fieldtype],inject:["storeName"],data(){return{selected:null,showFieldtype:!0,fields:[]}},watch:{form(t){this.showFieldtype=!1,this.refreshFields(),this.$nextTick(()=>this.showFieldtype=!0)}},computed:{form(){let t="forms."+this.row+".form.0";return data_get(this.$store.state.publish[this.storeName].values,t)},row(){return this.namePrefix.match(/\[(.*?)\]/)[1]}},mounted(){this.selected=this.value,this.form&&this.refreshFields()},methods:{refreshFields(){this.$axios.get(cp_url(`/activecampaign/form-fields/${this.form}`)).then(t=>{this.fields=t.data})}}};var D=function(){var e=this,s=e._self._c;return s("div",{staticClass:"form-field-fieldtype-wrapper"},[e.form?e._e():s("small",{staticClass:"help-block text-grey-60"},[e._v(e._s(e.__("Select form")))]),e.showFieldtype&&e.form?s("v-select",{attrs:{"append-to-body":"",clearable:!0,options:e.fields,reduce:i=>i.id,searchable:!0},on:{input:function(i){return e.$emit("input",i)}},model:{value:e.selected,callback:function(i){e.selected=i},expression:"selected"}}):e._e()],1)},E=[],O=o(N,D,E,!1,null,null,null,null);const P=O.exports;Statamic.booting(()=>{Statamic.$components.register("activecampaign-publish-form",x),Statamic.$components.register("activecampaign_merge_fields-fieldtype",T),Statamic.$components.register("form_fields-fieldtype",P)});
